<!DOCTYPE html>
<html lang="zh-Hant"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>普普風單字學習機</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&amp;display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fef3c7;
            background-image: radial-gradient(#fbbf24 15%, transparent 16%),
                              radial-gradient(#fbbf24 15%, transparent 16%);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
        }
        .pop-shadow { box-shadow: 8px 8px 0px #000; transition: all 0.2s ease-in-out; }
        .pop-shadow-sm { box-shadow: 4px 4px 0px #000; transition: all 0.2s ease-in-out; }
        .btn-press:active { transform: translate(4px, 4px); box-shadow: 0px 0px 0px #000; }
        textarea::-webkit-scrollbar { width: 12px; }
        textarea::-webkit-scrollbar-track { background: #fde68a; border-radius: 10px; }
        textarea::-webkit-scrollbar-thumb { background-color: #f59e0b; border-radius: 10px; border: 3px solid #fde68a; }
        .letter-btn {
            min-width: 3.5rem; /* 確保字母按鈕夠大，方便點擊 */
        }
        @keyframes shake {
          10%, 90% { transform: translate3d(-1px, 0, 0); }
          20%, 80% { transform: translate3d(2px, 0, 0); }
          30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
          40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .animate-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes blink {
            from, to { border-color: transparent; }
            50% { border-color: #334155; } /* slate-700 */
        }
        #spelling-cursor {
            display: inline-block;
            width: 0;
            height: 2.5rem; /* Match text-4xl line-height */
            border-right: 3px solid #334155; /* slate-700 */
            animation: blink 1s step-end infinite;
            vertical-align: bottom;
            margin-left: 2px;
        }
        .spelling-space {
            display: inline-block;
            width: 1ch;
            border-bottom: 3px solid #94a3b8; /* slate-400 */
            margin-bottom: 5px; /* Adjust alignment */
        }
        @keyframes pulse {
          0%, 100% {
            transform: scale(1);
            box-shadow: 8px 8px 0px #000;
          }
          50% {
            transform: scale(1.05);
            box-shadow: 10px 10px 0px #000;
          }
        }
        .recording {
          animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body class="p-4">

    <div class="w-full max-w-2xl mx-auto">
        <!-- 主畫面區 -->
        <div id="main-section">
            <div class="bg-sky-400 border-4 border-black rounded-xl p-6 md:p-8 pop-shadow">
                <h1 class="text-3xl md:text-4xl font-black text-white text-center drop-shadow-[2px_2px_0px_#000]">普普風單字學習機</h1>
                <p class="hidden text-center text-white mt-2 font-bold drop-shadow-[1px_1px_0px_#000]">請在下方貼上您的單字列表</p>
                <!-- 題目內容請在此處修改 -->
                <textarea id="word-input" class="hidden w-full h-48 mt-4 p-4 border-4 border-black rounded-lg text-lg pop-shadow-sm focus:outline-none focus:ring-4 focus:ring-amber-400" placeholder="一行一個單字，英文和中文用 Tab 分開。">Apple	蘋果
Pineapple	鳳梨
Grape	葡萄
Banana	香蕉
Mango	芒果
Orange	橙子／柳橙
Strawberry	草莓</textarea>
            </div>
             <!-- 模式選擇區 -->
            <div id="mode-selection-section" class="mt-6 bg-orange-500 border-4 border-black rounded-xl p-6 md:p-8 pop-shadow text-center">
                <h2 class="text-3xl font-black text-white drop-shadow-[2px_2px_0px_#000]">選擇練習模式</h2>
                <div class="mt-6 space-y-4">
                    <button data-mode="flashcard" class="mode-btn w-full bg-sky-400 text-white font-black text-xl py-4 rounded-lg border-4 border-black pop-shadow-sm btn-press hover:bg-sky-500">看中文猜英文 (單字卡)</button>
                    <button data-mode="spelling" class="mode-btn w-full bg-pink-500 text-white font-black text-xl py-4 rounded-lg border-4 border-black pop-shadow-sm btn-press hover:bg-pink-600">看中文拼單字</button>
                    <button data-mode="jumble" class="mode-btn w-full bg-lime-500 text-white font-black text-xl py-4 rounded-lg border-4 border-black pop-shadow-sm btn-press hover:bg-lime-600">字母重組</button>
                    <button data-mode="speech" class="mode-btn w-full bg-teal-500 text-white font-black text-xl py-4 rounded-lg border-4 border-black pop-shadow-sm btn-press hover:bg-teal-600">語音辨識練習</button>
                </div>
            </div>
        </div>

        <!-- 練習區塊 -->
        <div id="practice-section" class="hidden">
            <div id="progress-indicator" class="text-center text-xl font-bold mb-2 drop-shadow-[2px_2px_0px_#fff]"></div>
            
            <div class="relative bg-amber-300 border-4 border-black rounded-xl p-6 min-h-[450px] flex flex-col items-center justify-between pop-shadow">
                <div id="feedback-indicator" class="absolute top-4 right-4 text-2xl font-black"></div>
                <div class="w-full">
                    <div class="text-5xl md:text-6xl font-black text-center text-slate-800 break-all flex justify-center items-center gap-x-4 flex-wrap">
                        <span id="chinese-word"></span>
                        <button id="speak-emoji-btn" class="text-4xl md:text-5xl hover:scale-110 transition-transform active:scale-95">🔊</button>
                    </div>
                    <div id="english-word-container" class="hidden text-center mt-4">
                        <h2 id="english-word" class="text-6xl md:text-7xl font-black text-fuchsia-600 drop-shadow-[3px_3px_0px_#fff]"></h2>
                    </div>
                </div>

                <!-- 練習互動區 -->
                <div id="interaction-area" class="w-full mt-6">
                    <!-- 拼字模式 -->
                    <div id="spelling-mode" class="hidden">
                        <div id="spelling-answer" class="w-full bg-white min-h-[60px] p-2 flex justify-center items-center flex-wrap gap-1 text-4xl font-bold text-slate-800 tracking-widest rounded-lg border-4 border-dashed border-gray-500">
                            <span id="spelling-input-text"></span><span id="spelling-cursor"></span>
                        </div>
                        <div id="alphabet-keyboard" class="w-full mt-4 p-2 flex justify-center items-center flex-wrap gap-2"></div>
                    </div>
                    <!-- 字母重組模式 -->
                    <div id="jumble-mode" class="hidden">
                        <div id="jumble-answer" class="w-full bg-white min-h-[60px] p-2 flex justify-center items-center flex-wrap gap-2 border-4 border-dashed border-gray-500 rounded-lg"></div>
                        <div id="jumble-pool" class="w-full mt-4 p-2 flex justify-center items-center flex-wrap gap-2"></div>
                        <div class="w-full mt-2 flex justify-center items-center flex-wrap gap-2">
                            <button id="jumble-caps-btn" class="bg-gray-200 text-black font-bold text-xl py-2 px-4 rounded-lg border-4 border-black pop-shadow-sm btn-press">大小寫</button>
                        </div>
                    </div>
                    <!-- 語音辨識模式 -->
                    <div id="speech-mode" class="hidden text-center">
                        <button id="record-btn" class="w-40 h-40 mx-auto bg-red-500 text-white rounded-full border-8 border-black flex items-center justify-center pop-shadow btn-press active:scale-95 transition-transform disabled:opacity-50 disabled:cursor-not-allowed">
                            <svg class="w-20 h-20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.49 6-3.31 6-6.72h-1.7z"></path></svg>
                        </button>
                        <p id="recognition-status" class="mt-4 text-xl font-bold text-slate-700 h-8">點擊麥克風開始</p>
                        <div class="mt-2 min-h-[4rem] text-4xl font-black text-slate-800" id="recognized-text"></div>
                    </div>
                </div>

                <button id="check-answer-btn" class="mt-8 bg-green-500 text-white font-bold text-xl py-3 px-8 rounded-lg border-4 border-black pop-shadow-sm btn-press hover:bg-green-600">
                    檢查答案
                </button>
            </div>
            
             <div class="mt-6 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <button id="prev-button" class="nav-btn bg-cyan-400 text-white font-bold text-xl py-3 rounded-lg border-4 border-black pop-shadow-sm btn-press hover:bg-cyan-500 disabled:opacity-50">&lt; 上一個</button>
                    <button id="next-button" class="nav-btn bg-cyan-400 text-white font-bold text-xl py-3 rounded-lg border-4 border-black pop-shadow-sm btn-press hover:bg-cyan-500 disabled:opacity-50">下一個 &gt;</button>
                </div>
                <button id="back-to-main-button" class="w-full bg-gray-400 text-black font-bold text-xl py-3 rounded-lg border-4 border-black pop-shadow-sm btn-press hover:bg-gray-500">返回主選單</button>
            </div>
        </div>
    </div>

    <!-- Author Tag -->
    <p class="fixed bottom-4 right-4 bg-white/80 backdrop-blur-sm py-1 px-3 rounded-lg border-2 border-black text-sm font-semibold text-slate-700 pop-shadow-sm z-50">Made by 阿剛老師</p>

    <script>
        // DOM Elements
        const mainSection = document.getElementById('main-section');
        const practiceSection = document.getElementById('practice-section');
        const wordInput = document.getElementById('word-input');
        const modeButtons = document.querySelectorAll('.mode-btn');
        
        // Practice Section Elements
        const progressIndicator = document.getElementById('progress-indicator');
        const chineseWord = document.getElementById('chinese-word');
        const englishWordContainer = document.getElementById('english-word-container');
        const englishWord = document.getElementById('english-word');
        const checkAnswerBtn = document.getElementById('check-answer-btn');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const speakEmojiBtn = document.getElementById('speak-emoji-btn');
        const backToMainBtn = document.getElementById('back-to-main-button');
        const feedbackIndicator = document.getElementById('feedback-indicator');

        // Mode specific elements
        const spellingModeDiv = document.getElementById('spelling-mode');
        const spellingAnswer = document.getElementById('spelling-answer');
        const spellingInputText = document.getElementById('spelling-input-text');
        const alphabetKeyboard = document.getElementById('alphabet-keyboard');
        
        const jumbleModeDiv = document.getElementById('jumble-mode');
        const jumbleAnswer = document.getElementById('jumble-answer');
        const jumblePool = document.getElementById('jumble-pool');
        const jumbleCapsBtn = document.getElementById('jumble-caps-btn');
        
        const speechModeDiv = document.getElementById('speech-mode');
        const recordBtn = document.getElementById('record-btn');
        const recognitionStatus = document.getElementById('recognition-status');
        const recognizedText = document.getElementById('recognized-text');

        // App State
        let currentWordIndex = 0;
        let currentMode = '';
        let words = [];
        const synth = window.speechSynthesis;
        let audioCtx;
        let isCaps = false;

        // Speech Recognition State
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        let isRecording = false;

        // --- Audio Context and Sound Effects ---
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playSound(type) {
            if (!audioCtx) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.4, audioCtx.currentTime + 0.02);
            if (type === 'correct') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(783.99, audioCtx.currentTime + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2);
                oscillator.start(audioCtx.currentTime);
                oscillator.stop(audioCtx.currentTime + 0.2);
            } else {
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(164.81, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.3);
                oscillator.start(audioCtx.currentTime);
                oscillator.stop(audioCtx.currentTime + 0.3);
            }
        }
        
        // --- Keyboard Generation ---
        function createAlphabetKeyboard() {
            alphabetKeyboard.innerHTML = '';
            const alphabet = 'abcdefghijklmnopqrstuvwxyz';

            const lettersContainer = document.createElement('div');
            lettersContainer.className = 'w-full flex justify-center items-center flex-wrap gap-2';

            const addChar = (char) => {
                const charEl = document.createElement('span');
                if (char === ' ') {
                    charEl.innerHTML = '&nbsp;';
                    charEl.className = 'spelling-space';
                } else {
                    charEl.textContent = char;
                }
                spellingInputText.appendChild(charEl);
            };
            
            const letterButtons = [];

            for (const char of alphabet) {
                const btn = document.createElement('button');
                btn.className = 'letter-btn bg-pink-400 text-white font-black text-2xl py-2 px-3 rounded-lg border-4 border-black pop-shadow-sm btn-press';
                btn.textContent = char; // Initially lowercase
                btn.dataset.char = char; // Store base char
                btn.onclick = () => addChar(btn.textContent);
                lettersContainer.appendChild(btn);
                letterButtons.push(btn); // Keep a reference
            }
            alphabetKeyboard.appendChild(lettersContainer);

            const controlsContainer = document.createElement('div');
            controlsContainer.className = 'w-full mt-2 flex justify-center items-center flex-wrap gap-2';
            
            const capsLockBtn = document.createElement('button');
            capsLockBtn.className = 'bg-gray-200 text-black font-bold text-xl py-2 px-4 rounded-lg border-4 border-black pop-shadow-sm btn-press';
            capsLockBtn.textContent = '大小寫';
            capsLockBtn.onclick = () => {
                isCaps = !isCaps;
                capsLockBtn.classList.toggle('bg-yellow-400', isCaps);
                letterButtons.forEach(btn => {
                    const baseChar = btn.dataset.char;
                    btn.textContent = isCaps ? baseChar.toUpperCase() : baseChar.toLowerCase();
                });
            };

            const spaceBtn = document.createElement('button');
            spaceBtn.className = 'bg-gray-200 text-black font-bold text-xl py-2 px-4 rounded-lg border-4 border-black pop-shadow-sm btn-press flex-grow-[5]';
            spaceBtn.textContent = '空白鍵';
            spaceBtn.onclick = () => addChar(' ');

            const backspaceBtn = document.createElement('button');
            backspaceBtn.className = 'bg-yellow-400 text-black font-bold text-xl py-2 px-4 rounded-lg border-4 border-black pop-shadow-sm btn-press';
            backspaceBtn.innerHTML = '&larr; 刪除';
            backspaceBtn.onclick = () => {
                if (spellingInputText.lastChild) {
                    spellingInputText.removeChild(spellingInputText.lastChild);
                }
            };
            const clearBtn = document.createElement('button');
            clearBtn.className = 'bg-yellow-400 text-black font-bold text-xl py-2 px-4 rounded-lg border-4 border-black pop-shadow-sm btn-press';
            clearBtn.textContent = '清除';
            clearBtn.onclick = () => {
                spellingInputText.innerHTML = '';
            };

            controlsContainer.appendChild(capsLockBtn);
            controlsContainer.appendChild(spaceBtn);
            controlsContainer.appendChild(backspaceBtn);
            controlsContainer.appendChild(clearBtn);

            alphabetKeyboard.appendChild(controlsContainer);
        }

        // --- UI Navigation ---
        function showSection(sectionName) {
            mainSection.classList.add('hidden');
            practiceSection.classList.add('hidden');

            if (sectionName === 'main') {
                mainSection.classList.remove('hidden');
            } else if (sectionName === 'practice') {
                practiceSection.classList.remove('hidden');
            }
        }
        
        // --- Word Processing ---
        function processWords(text) {
             return text.trim().split('\n')
                .map(line => {
                    const parts = line.split('\t');
                    if (parts.length === 2 && parts[0].trim() !== '' && parts[1].trim() !== '') {
                        return { english: parts[0].trim(), chinese: parts[1].trim() };
                    }
                    return null;
                })
                .filter(word => word !== null);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- Practice Logic ---
        function startPractice(mode) {
            currentMode = mode;
            currentWordIndex = 0;
            const content = wordInput.value || "";
            words = shuffleArray(processWords(content));

            if (words.length === 0) {
                alert("沒有有效的單字！請在文字區塊中加入單字。");
                return;
            }
            initAudio();
            showSection('practice');
            setupPracticeUI();
            displayWord();
        }
        
        function setupPracticeUI() {
            spellingModeDiv.classList.add('hidden');
            jumbleModeDiv.classList.add('hidden');
            speechModeDiv.classList.add('hidden');
            englishWordContainer.classList.add('hidden');
            checkAnswerBtn.classList.remove('hidden');

            checkAnswerBtn.textContent = (currentMode === 'flashcard') ? '看答案' : '檢查答案';

            if (currentMode === 'spelling') spellingModeDiv.classList.remove('hidden');
            if (currentMode === 'jumble') jumbleModeDiv.classList.remove('hidden');
            if (currentMode === 'speech') {
                speechModeDiv.classList.remove('hidden');
                checkAnswerBtn.classList.add('hidden');
            }
        }

        function displayWord() {
            const currentWord = words[currentWordIndex];
            progressIndicator.textContent = `單字 ${currentWordIndex + 1} / ${words.length}`;
            chineseWord.textContent = currentWord.chinese;
            englishWord.textContent = currentWord.english;
            feedbackIndicator.textContent = '';
            englishWordContainer.classList.add('hidden');
            checkAnswerBtn.disabled = false;
            
            if (currentMode === 'spelling') {
                spellingInputText.innerHTML = '';
                alphabetKeyboard.classList.remove('opacity-50', 'pointer-events-none');
            } else if (currentMode === 'jumble') {
                jumbleAnswer.innerHTML = '';
                jumblePool.innerHTML = '';
                const letters = shuffleArray(currentWord.english.split(''));
                letters.forEach(letter => {
                    const btn = document.createElement('button');
                    btn.className = 'letter-btn bg-pink-400 text-white font-black text-2xl py-2 px-4 rounded-lg border-4 border-black pop-shadow-sm btn-press';
                    btn.textContent = isCaps ? letter.toUpperCase() : letter.toLowerCase();
                    btn.dataset.char = letter.toLowerCase();
                    btn.onclick = () => moveLetter(btn, jumblePool, jumbleAnswer);
                    jumblePool.appendChild(btn);
                });
                jumbleCapsBtn.classList.toggle('bg-yellow-400', isCaps);
            } else if (currentMode === 'speech') {
                recognizedText.textContent = '';
                recognitionStatus.textContent = '點擊麥克風開始';
                recordBtn.disabled = false;
            }
            prevButton.disabled = currentWordIndex === 0;
            nextButton.disabled = currentWordIndex === words.length - 1;
        }
        
        function moveLetter(letterBtn, from, to) {
            letterBtn.onclick = () => moveLetter(letterBtn, to, from);
            to.appendChild(letterBtn);
        }

        function checkAnswer() {
            if (currentMode === 'flashcard') {
                 englishWordContainer.classList.remove('hidden');
                 checkAnswerBtn.disabled = true;
                 return;
            }
            let isCorrect = false;
            const correctEng = words[currentWordIndex].english.toLowerCase();
            if (currentMode === 'spelling') {
                const userAnswer = Array.from(spellingInputText.children).map(node => {
                    return node.classList.contains('spelling-space') ? ' ' : node.textContent;
                }).join('');
                isCorrect = userAnswer.toLowerCase() === correctEng;
            } else if (currentMode === 'jumble') {
                const userAnswer = Array.from(jumbleAnswer.children).map(btn => btn.textContent).join('');
                isCorrect = userAnswer.toLowerCase() === correctEng;
            }
            
            playSound(isCorrect ? 'correct' : 'incorrect');
            feedbackIndicator.textContent = isCorrect ? '✅' : '❌';
            feedbackIndicator.style.color = isCorrect ? 'green' : 'red';
            
            if (isCorrect) {
                englishWordContainer.classList.remove('hidden');
                checkAnswerBtn.disabled = true;
                if (currentMode === 'spelling') alphabetKeyboard.classList.add('opacity-50', 'pointer-events-none');
                setTimeout(() => {
                    if (currentWordIndex < words.length - 1) nextButton.click();
                }, 1500);
            } else {
                if (currentMode === 'spelling') {
                   spellingAnswer.classList.add('animate-shake');
                   setTimeout(() => spellingAnswer.classList.remove('animate-shake'), 500);
                }
            }
        }
        
        function speakWord() {
            if (synth.speaking || words.length === 0) return;
            const utterThis = new SpeechSynthesisUtterance(words[currentWordIndex].english);
            utterThis.lang = 'en-US';
            utterThis.rate = 0.9;
            synth.speak(utterThis);
        }

        // --- Speech Recognition Logic ---
        function initSpeechRecognition() {
            if (!SpeechRecognition) {
                console.error("此瀏覽器不支援語音辨識功能。");
                // Disable speech button if not supported
                const speechButton = document.querySelector('button[data-mode="speech"]');
                if(speechButton) {
                    speechButton.disabled = true;
                    speechButton.textContent = '不支援語音辨識';
                    speechButton.classList.add('opacity-50', 'cursor-not-allowed');
                }
                return;
            }

            recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onstart = () => {
                isRecording = true;
                recordBtn.classList.add('recording');
                recognitionStatus.textContent = '正在聆聽...';
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                handleRecognitionResult(transcript);
            };

            recognition.onerror = (event) => {
                if (event.error === 'no-speech') {
                    recognitionStatus.textContent = '聽不到聲音，請再試一次';
                } else if (event.error === 'not-allowed') {
                    recognitionStatus.textContent = '未授權使用麥克風';
                } else {
                    recognitionStatus.textContent = `發生錯誤: ${event.error}`;
                }
                console.error('Speech recognition error:', event.error);
            };

            recognition.onend = () => {
                isRecording = false;
                recordBtn.classList.remove('recording');
                if (recognitionStatus.textContent === '正在聆聽...') {
                    recognitionStatus.textContent = '點擊麥克風開始';
                }
            };
        }

        function handleRecognitionResult(transcript) {
            recognizedText.textContent = `「${transcript}」`;
            const correctEng = words[currentWordIndex].english.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
            const userEng = transcript.trim().toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");

            const isCorrect = userEng === correctEng;

            playSound(isCorrect ? 'correct' : 'incorrect');
            feedbackIndicator.textContent = isCorrect ? '✅' : '❌';
            feedbackIndicator.style.color = isCorrect ? 'green' : 'red';

            if (isCorrect) {
                recordBtn.disabled = true;
                englishWordContainer.classList.remove('hidden');
                setTimeout(() => {
                    if (currentWordIndex < words.length - 1) {
                        nextButton.click();
                    }
                }, 1500);
            } else {
                recognitionStatus.textContent = '答錯了，再試一次！';
            }
        }
        
        // --- Event Listeners ---
        jumbleCapsBtn.addEventListener('click', () => {
            isCaps = !isCaps;
            jumbleCapsBtn.classList.toggle('bg-yellow-400', isCaps);
            
            const allJumbleButtons = document.querySelectorAll('#jumble-pool .letter-btn, #jumble-answer .letter-btn');
            
            allJumbleButtons.forEach(btn => {
                const baseChar = btn.dataset.char;
                if (baseChar) { 
                   btn.textContent = isCaps ? baseChar.toUpperCase() : baseChar.toLowerCase();
                }
            });
        });
        
        modeButtons.forEach(btn => {
            btn.addEventListener('click', () => startPractice(btn.dataset.mode));
        });

        checkAnswerBtn.addEventListener('click', checkAnswer);
        speakEmojiBtn.addEventListener('click', speakWord);
        backToMainBtn.addEventListener('click', () => showSection('main'));

        recordBtn.addEventListener('click', () => {
            if (!isRecording && recognition) {
                recognition.start();
            }
        });
        
        nextButton.addEventListener('click', () => {
            if (currentWordIndex < words.length - 1) {
                currentWordIndex++;
                displayWord();
            }
        });
        prevButton.addEventListener('click', () => {
            if (currentWordIndex > 0) {
                currentWordIndex--;
                displayWord();
            }
        });
        
        // --- Initial Load ---
        window.addEventListener('load', () => {
            showSection('main');
            createAlphabetKeyboard();
            initSpeechRecognition();
        });

    </script>



</body></html>